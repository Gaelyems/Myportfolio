# Key Commands

### Metasploit

#### Searching Metasploit Modules

Metasploit has an overwhelming amount of modules. Being able to search them quickly and efficiently will help you save time.

```bash
# Search for Windows Modules
msf > search Windows
```

```bash
# Search for modules to gather information from a Windows machine
msf > search post/windows/gather
```

Use Metasploit's custom version of `grep` to narrow things down

```bash
# Search for `smb` within the results of post/windows/gather
msf > grep 'smb' search post/windows/gather
```


#### Using a Module

Once you have a module you want to try, you need to load it into Metasploit with the `use` command.

```bash
# Load the hashdump module
msf > use post/windows/gather/hashdump
```

After you load a module, you'll want to take a look at it's options.

```bash
# View the options of the currently loaded module
msf post(windows/gather/hashdump) > options
```

If you would like to unload your current module, use `back`

```bash
msf post(windows/gather/hashdump) > back
```

<details>
  <summary>Expand for more general Metasploit commands</summary>
  <ul>
    <li><code>set</code>Set an option
    <li><code>run</code>Run a module
    <li><code>run -j</code>Run a module in the background
    <li><code>db_nmap</code>run an Nmap scan and save it in the metasploit database
    <li><code>hosts</code>View hosts recorded in the database
    <li><code>services</code>View services recorded in the database
    <li><code>creds</code>View credentials recorded in the database
    <li><code>sessions</code>View meterpreter sessions recorded in the database
  </ul>
</details>


### Meterpreter

Once you have a Meterpreter session going, there are a number of commands available for you to gather more info from the victim.

```bash
# Attach to meterpreter session 1
msf > sessions -i 1
```
```bash
# Get the user ID and username of the current user
meterpreter > getuid
```
```bash
# Get the networking information
meterpreter > ifconfig
```

<details>
  <summary>Expand for more Meterpreter commands</summary>
  <ul>
    <li><code>?</code> View a list of Meterpreter commands
    <li><code>getprivs</code> escalate your privileges on the victim system
    <li><code>background</code> exit the meterpreter shell and return to msf (the meterpreter session stays open in the background)
    <li><code>download</code> download a file from the victim
    <li><code>upload</code> Upload a file to the victim
    <li><code>ls</code> list the files in a directory
    <li><code>cd</code> change directory
  </ul>
</details>

### Useful Metasploit Modules
The following modules are used _after_ you first obtain a Meterpreter session on a target machine. They are quite useful during the pillaging stage.

- `post/windows/gather/enum_services`: Enumerate service information. This is important for adequately profiling the target machine, as well as identifying opportunities for exploiting unquoted service paths for **privilege escalation**.

- `post/windows/gather/enum_shares`: Enumerate file shares.

- `post/windows/gather/win_privs`: Prints information about the privileges you have on your target machine. This includes whether you are currently logged in as a user, administrator, or as SYSTEM; whether UAC (User Access Control) is enabled; and information about any special permissions enabled for your current user.

- `post/windows/gather/credentials/sso`: Dump single sign-on credentials, in plaintext. This module requires you to have administrator privileges on your victim machine. If you have that, this module will dump usernames and passwords that you can use to sign into and/or authorize a wide variety of Windows services.

<details>
  <summary>Expand for other useful modules</summary>
  <ul>
    <li><code>post/windows/gather/hashdump</code> Dumps any username and NTLM hashes from system memory and saves them in the Metasploit database.
    <li><code>post/windows/gather/enum_domains</code> Finds active directory domains
    <li><code>post/windows/gather/enum_shares</code> Finds SMB file shares
    <li><code>post/windows/gather/enum_logged_on_users</code> Finds all users that are logged on to the machine.
    <li><code>post/windows/gather/enum_services</code> Finds all services running on the target machine.
    <li><code>post/windows/gather/forensics/browser_history</code> Finds browser history on the target machine.
  </ul>
</details>
